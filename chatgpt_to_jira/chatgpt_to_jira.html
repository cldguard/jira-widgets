 <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 1.5rem;
      background: #f5f5f5;
    }
    h1 {
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
    }
    .container {
      display: flex;
      gap: 1rem;
      align-items: stretch;
    }
    .pane {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    textarea {
      width: 100%;
      height: 70vh;
      font-family: Consolas, "Courier New", monospace;
      font-size: 0.9rem;
      padding: 0.5rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      resize: vertical;
    }
    #outputContainer {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    #output {
      white-space: pre-wrap;
      padding: 0.5rem;
      background: #ffffff;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-family: Consolas, "Courier New", monospace;
      font-size: 0.9rem;
      height: 70vh;
      overflow: auto;
    }
    .controls {
      margin: 0.5rem 0 0.5rem 0;
      display: flex;
      gap: 0.5rem;
    }
    button {
      padding: 0.35rem 0.75rem;
      font-size: 0.9rem;
      cursor: pointer;
      border-radius: 4px;
      border: 1px solid #0077cc;
      background: #0077cc;
      color: white;
    }
    button.secondary {
      border-color: #666;
      background: #fff;
      color: #333;
    }
    small {
      color: #555;
    }
  </style>

  <h1>ChatGPT → Jira Markup Formatter</h1>
  <p>
    Paste ChatGPT’s markdown output on the left, then click <strong>Convert</strong>.
    Copy the Jira markup from the right into your Jira comment.
  </p>

  <div class="container">
    <div class="pane">
      <label for="input"><strong>ChatGPT / Markdown Input</strong></label>
      <textarea id="input" placeholder="Paste ChatGPT response here..."></textarea>
      <div class="controls">
        <button id="convertBtn">Convert → Jira</button>
      </div>
    </div>

    <div id="outputContainer">
      <label for="output"><strong>Jira Markup Output</strong></label>
      <!-- <pre id="output"></pre> -->
      <textarea id="output" placeholder="JIRA formatted text ends up here..."></textarea>
      <div class="controls">
        <button id="copyBtn" class="secondary">Copy Jira Markup</button>
        <small>
          Code fences like <code>```cpp</code> become <code>{code:language=cpp}</code>.
          <code>**bold**</code> → <code>*bold*</code>, <code>`italic`</code> → <code>_italic_</code>.
        </small>
      </div>
    </div>
  </div>

  <script>
    function convertMarkdownToJira(markdown) {
      const lines = markdown.split(/\r?\n/);
      const out = [];

      let inCodeBlock = false;
      let codeLang = null;
      let codeTitle = null;

      for (let rawLine of lines) {
        let line = rawLine;

        // Handle fenced code blocks: ``` or ```lang or ```lang title
        const fenceMatch = line.match(/^\s*```(?:\s*(\w+))?(?:\s+(.+))?\s*$/);
        if (fenceMatch) {
          if (!inCodeBlock) {
            // starting code block
            codeLang = fenceMatch[1] || null;
            codeTitle = fenceMatch[2] || null;

            let tag;
            if (codeLang && codeTitle) {
              tag = `{code:language=${codeLang}|title=${codeTitle}}`;
            } else if (codeLang) {
              tag = `{code:language=${codeLang}}`;
            } else {
              tag = "{code}";
            }
            out.push(tag);
            inCodeBlock = true;
          } else {
            // ending code block
            out.push("{code}");
            inCodeBlock = false;
            codeLang = null;
            codeTitle = null;
          }
          continue;
        }

        if (inCodeBlock) {
          // Inside code block: do NOT transform
          out.push(line);
          continue;
        }

        // Headings: #, ##, ### → h1., h2., h3. etc.
        let headingMatch = line.match(/^\s*(#{1,6})\s+(.*)$/);
        if (headingMatch) {
          const level = headingMatch[1].length;
          const text = headingMatch[2];
          out.push("h" + level + ". " + text);
          continue;
        }

        // Blockquote: > text → bq. text
        const bqMatch = line.match(/^\s*>\s?(.*)$/);
        if (bqMatch) {
          out.push("bq. " + bqMatch[1]);
          continue;
        }

        // Horizontal rule: --- → ---- (Jira rule)
        if (/^\s*---+\s*$/.test(line)) {
          out.push("----");
          continue;
        }

        // Unordered list: -, * → * item
        const ulMatch = line.match(/^\s*[-*]\s+(.*)$/);
        if (ulMatch) {
          out.push("* " + ulMatch[1]);
          continue;
        }

        // Ordered list: 1. item → # item
        const olMatch = line.match(/^\s*\d+\.\s+(.*)$/);
        if (olMatch) {
          out.push("# " + olMatch[1]);
          continue;
        }

        // Default: push line as-is
        out.push(line);
      }

      let jira = out.join("\n");

      // 2. **text** → *text* (bold)
      jira = jira.replace(/\*\*(.+?)\*\*/g, "*$1*");

      // 3. `text` → _text_ (italic)
      jira = jira.replace(/`([^`]+)`/g, "_$1_");

      // Links: [text](url) → [text|url]
      jira = jira.replace(/\[([^\]]+)\]\(([^)]+)\)/g, "[$1|$2]");

      return jira;
    }

    document.getElementById("convertBtn").addEventListener("click", function () {
      const input = document.getElementById("input").value || "";
      const jira = convertMarkdownToJira(input);
      const outputEl = document.getElementById("output");
      outputEl.value = jira; // set textarea's value so it can be copied
    });

    document.getElementById("copyBtn").addEventListener("click", async function () {
      // const text = document.getElementById("output").textContent || "";
      const text = document.getElementById("output").value || "";
      if (!text.trim()) return;

      try {
        await navigator.clipboard.writeText(text);
        alert("Jira markup copied to clipboard.");
      } catch (e) {
        alert("Could not copy to clipboard. Please select and copy manually.");
      }
    });
  </script>
